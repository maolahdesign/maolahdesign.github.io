## 數據分析與視覺化

### 樞紐分析表基礎與進階功能

*   **內容解說：**
    *   **樞紐分析是什麼：** 解釋樞紐分析表是 Excel 中最強大的互動式數據匯總工具，能快速將雜亂的明細數據，轉換成有意義的交叉分析報表。
    *   **四大欄位區塊：** 詳細介紹「篩選」、「欄」、「列」、「值」四個區域的功能與應用場景，這是樞紐分析的基石。
    *   **基礎操作：** 從建立第一張樞紐分析表開始，學習如何拖拉欄位、變更值的計算方式（總計、計數、平均）。
    *   **進階功能：**
        1.  **交叉分析篩選器 (Slicer) & 時間表 (Timeline)：** 讓報表從靜態變為動態，實現儀表板般的互動式篩選體驗。
        2.  **群組功能：** 將日期（年/季/月）、數字（價格區間）進行分組，以更高維度進行分析。
        3.  **計算欄位 (Calculated Field)：** 在樞紐分析表內直接建立新欄位（如：毛利率、客單價），無需修改原始數據。
        4.  **值的顯示方式：** 將數值變更為「佔總和百分比」、「差異百分比」等，進行深度比較分析。
    
*   **操作範例：**
    
    * **範例資料：** 農產品交易行情表。
    
    *   **操作任務：**
        1. 選擇**插入**標籤後點擊**樞紐分析表**
        
        2. 在工作表標籤選擇滑鼠右鍵選擇**重新命名**
        
        3. 透過**勾選或拖曳方式**將欄位放入四大欄位區塊
           1. 產品名稱，平均價，交易量
           
           2. 將市場加入到列
           
           3. 只選擇幾個主要市場
           
           4. 將市場移至欄
           
           5. 修改無交易空格欄位
           
              1. 在空格上按滑鼠右鍵，選擇**樞紐分析表選項**
              2. 在 若為空白儲存格，顯示 填入0，按**確定**完成修改
           
           6. 檢視詳細交易資料 : 在儲存個數值上雙擊滑鼠左鍵
           
           7. 與原表格保持連動 : 原表格數據做任何新增或修改後，在樞紐分析表按滑鼠右鍵，選擇重新整理即可進行資料同步。
              另一個方法可選擇資料標籤，點擊**全部重新整理** 。
           
        4. **任務A (基礎)：** 建立樞紐分析表，分析「市場」在「產品類別」的「總銷售額」。
        
        5. **任務B (進階)：**
           * 新增「銷售額」的**計算欄位** (`= 平均價 * 交易量`)。
             1. 點擊功能區中的「樞紐分析表分析 (PivotTable Analyze)」索引標籤。
             2. 在「計算 (Calculations)」群組中，點擊「欄位、項目與集合 (Fields, Items, & Sets)」按鈕。
             3. 在下拉選單中，選擇「計算欄位... (Calculated Field...)」。
             4. 此時會彈出一個「插入計算欄位 (Insert Calculated Field)」的對話框。
             5. 名稱 (Name)：
                 * 在「名稱」欄位中，輸入您新欄位的名稱，例如：銷售額。
             6. 公式 (Formula)：
                 * 在「公式」欄位中，您會看到預設的 =0。請先將 0 刪除。
                 * 在下方的「欄位 (Fields)」清單中，找到 平均價。
                 * 雙擊 平均價 (或點選 平均價 後再點擊「插入欄位」按鈕)，它會被插入到公式欄位中。
                 * 在公式欄位中輸入 * (乘號)。
                 * 在「欄位」清單中，找到 交易量。
                 * 雙擊 交易量 (或點選 交易量 後再點擊「插入欄位」按鈕)，它會被插入到公式欄位中。
                 * 現在，您的公式欄位應該顯示為：=平均價 * 交易量。
             7. 新增並確定：
                 * 點擊「新增 (Add)」按鈕。
                 * 點擊「確定 (OK)」按鈕。
           * 新增「市場」和「產品類別」的**交叉分析篩選器**。
             1. ctrl + A 全選資料表單，然後 ctrl + C 複製
             2. 在右邊空白儲存格貼上
             3. 選擇**插入**標籤，然後點選**交叉分析篩選器**
             4. 在篩選器上按滑鼠右鍵選擇**顯示設定**
             5. 捲動右邊設定找到樞紐分析表連線，確認勾選樞紐分析表 1 及分析表 2
           * 將「銷售額」複製一份，並將其**值的顯示方式**改為「佔總和百分比」。
             1. 在「樞紐分析表欄位 (PivotTable Fields)」窗格的「值 (Values)」區域中。
             2. 點擊新複製出來的「銷售額2」欄位旁邊的下拉箭頭。
             3. 選擇「值欄位設定 (Value Field Settings...)」。
             4. 在跳出的「值欄位設定」對話框中，切換到「顯示值方式 (Show Values As)」索引標籤。
             5. 在「顯示值方式」的下拉選單中，選擇「總計百分比 (% of Grand Total)」。
             6. 點擊「確定」。
             
        > 實作練習：使用銷售紀錄表完成以下任務
        >
        > 1. 建立樞紐分析表
        > 2. 將「銷售額」複製一份，並將其值的顯示方式改為「佔總和百分比」
        > 3. 新增「市場」和「產品類別」的交叉分析篩選器
---

### 統計圖表的設計與應用

*   **內容解說：**
    *   **圖表是數據的語言：** 強調圖表的目的在於「講故事」，快速傳達數據背後的洞見。
    *   **從樞紐分析到樞紐分析圖：** 學習如何一鍵將樞紐分析表轉換為連動的樞紐分析圖，讓數據分析結果視覺化。
    *   **選擇正確的圖表類型：**
        *   **長條圖/柱狀圖：** 用於比較不同類別的數值大小。
        *   **折線圖：** 用於呈現隨時間變化的趨勢。
        *   **圓餅圖：** 用於顯示各部分佔整體的比例（提醒：類別過多時不適用）。
        *   **組合圖：** 將不同度量單位（如銷售額與成長率）呈現在同一張圖上，進行多維度比較。
    *   **圖表設計原則：** 介紹如何美化圖表，包括移除不必要的格線、加上清晰的標題與資料標籤，讓圖表簡潔有力。

*   **操作範例：**
    *   **範例資料：** 延續單元一的樞紐分析表結果。
    *   **操作任務：**
        1.  **任務A：** 基於分析「各區域每月銷售額」的樞紐分析表，建立一張**折線圖**，呈現各區域的銷售趨勢。
        2.  **任務B：** 建立一張**組合圖**，同時呈現各產品類別的「總銷售額」（柱狀圖）與「毛利率」（折線圖，使用副座標軸）。
    > 實作練習：使用銷售紀錄表完成以下任務
    >
    > 完成「2007 年每月銷售額」的樞紐分析表，並建立一張**折線圖**，呈現全年的銷售趨勢。
    
---

### 資料透視與結構化分析

*   **內容解說：**
    *   **Garbage In, Garbage Out：** 強調數據品質的重要性。結構混亂的資料無法進行有效分析。
    *   **何謂「結構化資料 (Tidy Data)」：** 介紹標準的清單式資料結構（一列一筆記錄，一欄一個變數），這是樞紐分析與多數分析工具的基礎要求。
    *   **常見的非結構化資料：** 展示常見的錯誤格式，如合併儲存格、多層標題、以及將月份當作欄位的「交叉表」。
    *   **Power Query 逆樞紐 (Unpivot)：** Excel 內建的強大 ETL (萃取、轉換、載入) 工具 Power Query，並聚焦於其核心功能「逆樞紐分析行」，能快速將交叉表轉換為結構化清單。

### 逆樞紐操作範例

*   **範例資料：** 一份產品銷售報告，第一欄是「產品名稱」，後續欄位分別是「一月銷售額」、「二月銷售額」、「三月銷售額」...
*   **操作任務：**

    - 使用 Power Query 載入資料
       1. 選取表格內任一儲存格。
       2. 前往 Excel 頂端功能區的「資料 (Data)」索引標籤。
       3. 在「取得及轉換資料 (Get & Transform Data)」群組中，點擊「從表格/範圍 (From Table/Range)」。
       4. 此時，Power Query 編輯器會開啟，並載入您的銷售資料。
    - 執行「取消其他資料行的樞紐」
       這是核心步驟，將寬表格轉換成長表格。

       1. 在 Power Query 編輯器中，選取「產品名稱」這一欄。
          * 為什麼選「產品名稱」？ 因為這是您不希望被逆樞紐的識別欄位。您希望它保持不變，而其他月份欄位則被「融化」到它下方。
       2. 在選取的「產品名稱」欄位標題上按一下滑鼠右鍵。
       3. 在跳出的選單中，選擇「取消其他資料行的樞紐 (Unpivot Other Columns)」。
          * 解說：這個功能會將所有未被選取的欄位（即「一月銷售額」、「二月銷售額」、「三月銷售額」）進行逆樞紐操作。
    - 重新命名新產生的欄位

        執行逆樞紐後，您會看到原本的月份欄位消失了，取而代之的是兩個新欄位，預設名稱為「屬性 (Attribute)」和「值 (Value)」。

        1. 重新命名「屬性」欄位：
           * 在「屬性」欄位標題上按兩下（或按右鍵選擇「重新命名」）。
           * 將其名稱修改為「月份」。
        2. 重新命名「值」欄位：
           * 在「值」欄位標題上按兩下。
           * 將其名稱修改為「銷售額」。

        現在，您的資料已經是乾淨的「產品名稱」、「月份」、「銷售額」三欄結構化資料了！
    - 載入整理好的資料
        1. 在 Power Query 編輯器的左上角，點擊「常用 (Home)」索引標籤。
        2. 點擊「關閉並載入 (Close & Load)」按鈕。
        3. 在下拉選單中，選擇「關閉並載入至... (Close & Load To...)」。
        4. 在「載入至」對話框中，選擇「表格 (Table)」和「新工作表 (New Worksheet)」。
        5. 點擊「確定 (OK)」。

---

### 自動化數據處理範例

*   **內容解說：**
    *   **告別重複的手動操作：** Power Query 的所有操作步驟都會被記錄下來，形成一個可重複執行的查詢。當來源資料更新或增加時，只需一鍵「重新整理」，所有整理步驟都會自動重跑。
    *   **合併多份檔案：** 介紹 Power Query 最令人驚豔的功能之一：從資料夾合併多個結構相同的檔案（Excel 或 CSV）。這對於需要匯總每月、每週或各分店報表的工作極為高效。
    *   **數據格式轉換：** 在 Power Query 編輯器中，可以輕鬆完成資料類型轉換（如將文字格式的日期轉為日期格式）、分割欄位、取代文字等常見的數據清理工作。
*   **操作範例一：**
    *   **範例資料：** 一個資料夾，內含三份結構完全相同的銷售報表：台北一.csv, 台北二.csv, 板橋區.csv。
    *   **操作任務：**
        1.  開啟 Power Query，點選資料選單>取得資料，選擇「**從檔案**」>「**從資料夾**」。
        2.  選取包含三份報表的資料夾，點擊「**合併與轉換資料**」。
        3.  Power Query 會自動將所有檔案的內容合併成一個大的資料表。
        4.  **驗證：** 將一份新的 `台北市場.csv` 檔案放入同一個資料夾，然後在 Excel 中對查詢按下滑鼠右鍵選擇「**重新整理**」，觀察到4月的數據被自動合併進來。
*   **操作範例二：**
    *   **範例資料：** 將農產品交易行情資料表內各市場資料進行匯總。
    *   **操作任務：**
        1.  方法一 : 複製貼上
        2.  方法二 : VBA
        3.  選擇台北一工作表的任一儲存格。
        4.  開啟 Power Query，點選資料選單>取得資料，選擇「**從檔案**」>「**從excel 活頁簿**」。
        5.  選擇**農產品交易行情.xlsx**
        6.  選取要合併的工作表，點擊「**轉換資料**」。
        7.  選取標籤**常用**的**附加查詢**選單，下拉選取**將查詢附加為新查詢**。
        8.  選取要合併的工作表
        9.  變更工作表名稱**附加一**為**全區**
        10.  選取「**關閉並載入**」
        11.  刪除重複匯入工作表
        12.  Power Query 會自動將所有檔案的內容合併成一個大的資料表。
        13.  **驗證：** 新增一筆資料後按儲存，然後在 合併工作表 中按下滑鼠右鍵選擇「**重新整理**」，觀察新數據是否被自動加進來。        

---

### 逆樞紐分析行

1. 什麼是「逆樞紐分析行」？

    簡單來說，它是一個「將寬表格變成長表格」的魔法按鈕。
    
    * 寬表格 (Wide Table)：人類喜歡看的格式。通常特徵或數值被當作欄位標題，例如每個月的銷售額分別佔據一欄。
    * 長表格 (Long Table)：電腦和分析工具喜歡的格式。也稱為「Tidy Data」，所有數值都在同一個欄位中，而它們的特徵則在另一個欄位。
    
    「逆樞紐分析行」的作用，就是把那些作為「欄位標題」的特徵（例如 "一月", "二月"）融化 (Melt) 或 堆疊 (Stack) 下來，變成一欄新的資料。

2. 一個簡單的視覺化範例

    文字可能有點抽象，讓我們看一個「之前 vs. 之後」的例子，您馬上就能明白。
    
    處理前：寬表格 (不適合分析的格式)
    
    假設您的原始報表長這樣，第一欄是產品，後面幾欄分別是不同月份的銷售額。
    
    
    
    | 產品 | 一月 | 二月 | 三月 |
    |---|---|---|---|
    | 蘋果 | 100  | 120  | 150  |
    | 香蕉 | 80   | 90   | 110  |
    
    
    
    問題點：一月、二月、三月
    這些本質上是「時間」的值，卻被當成了欄位。這種格式讓您很難用樞紐分析表去分析「哪種水果的總銷量最高」或「全年的銷售趨勢」。
    
    處理後：長表格 (適合分析的格式)
    
    經過「逆樞紐分析行」處理後，表格會變成這樣：
    
    
    
    | 產品 | 月份 | 銷售額 |
    |---|---|---|
    | 蘋果 | 一月 | 100    |
    | 蘋果 | 二月 | 120    |
    | 蘋果 | 三月 | 150    |
    | 香蕉 | 一月 | 80     |
    | 香蕉 | 二月 | 90     |
    | 香蕉 | 三月 | 110    |
    
    
    發生了什麼事？
    
    1. 原本的 一月、二月、三月 這三個欄位被「融化」並合併成一個新的欄位，我們將其命名為「月份」。
    2. 原本在這三個欄位下的所有數值，則被集中到另一個新的欄位，我們將其命名為「銷售額」。
    3. 產品 欄位作為固定的識別欄，其內容會被自動向下填充，以匹配新的資料結構。

3. 如何操作？(操作步驟)

    在 Power Query 編輯器中，操作非常簡單：
    
    1. 載入資料：首先，將您的寬表格載入到 Power Query 編輯器中。
    
    2. 選取欄位：這是最關鍵的一步。您有兩種策略：
       * 策略A (推薦)：選取不需要被逆樞紐的欄位。在我們的例子中，就是選取「產品」這一欄。
       * 策略B：選取所有需要被逆樞紐的欄位。在我們的例子中，就是同時選取「一月」、「二月」和「三月」這三欄。
    
    3. 執行逆樞紐：
       * 前往頂端選單的「轉換 (Transform)」索引標籤。
       * 點擊「逆樞紐分析行 (Unpivot Columns)」按鈕的下拉箭頭。
       * 如果您採用策略A，請選擇「取消其他資料行的樞紐 (Unpivot Other
         Columns)」。(這是最常用的選項，因為未來如果增加了「四月」的欄位，這個查詢步驟依然有效)。
       * 如果您採用策略B，請選擇「取消資料行的樞紐 (Unpivot Columns)」。

    4. 重新命名：
       Power Query 會自動產生兩個新欄位，預設名稱為 屬性 (Attribute) 和 值 (Value)。請對這兩個新欄位的標題按兩下，將它們重新命名為有意義的名稱，例如「月份」和「銷售額」。
    
    5. 關閉並載入：
       點擊左上角的「關閉並載入」，將整理好的長表格載入到新的 Excel 工作表中。

4. 為什麼這個功能如此重要？

* 為了樞紐分析：只有「長表格」格式的資料，才能在樞紐分析表中發揮最大作用，讓您可以隨意拖拉「月份」或「產品」到欄、列或篩選區域。
* 為了自動化：這個轉換步驟會被 Power Query 記錄下來。下個月，當您的原始報表增加了「四月」的欄位時，您不需要重複任何操作，只需在查詢結果上按右鍵「重新整理」，四月的資料就會自動被逆樞紐並追加到長表格的末端。
* 為了標準化：它是將各種不規範、人類可讀的報表，轉換為標準化、機器可讀的「資料庫格式」的核心工具。


