## 數據分析與視覺化

### 樞紐分析表基礎與進階功能

*   **內容解說：**
    *   **樞紐分析是什麼：** 解釋樞紐分析表是 Excel 中最強大的互動式數據匯總工具，能快速將雜亂的明細數據，轉換成有意義的交叉分析報表。
    *   **四大欄位區塊：** 詳細介紹「篩選」、「欄」、「列」、「值」四個區域的功能與應用場景，這是樞紐分析的基石。
    *   **基礎操作：** 從建立第一張樞紐分析表開始，學習如何拖拉欄位、變更值的計算方式（總計、計數、平均）。
    *   **進階功能：**
        1.  **交叉分析篩選器 (Slicer) & 時間表 (Timeline)：** 讓報表從靜態變為動態，實現儀表板般的互動式篩選體驗。
        2.  **群組功能：** 將日期（年/季/月）、數字（價格區間）進行分組，以更高維度進行分析。
        3.  **計算欄位 (Calculated Field)：** 在樞紐分析表內直接建立新欄位（如：毛利率、客單價），無需修改原始數據。
        4.  **值的顯示方式：** 將數值變更為「佔總和百分比」、「差異百分比」等，進行深度比較分析。
*   **操作範例：**
    
    *   **範例資料：** 一份包含「日期」、「銷售區域」、「產品類別」、「銷售額」、「成本」的銷售明細表。
    *   **操作任務：**
        1. 選擇**插入**標籤後點擊**樞紐分析表**
        2. 在工作表標籤選擇滑鼠右鍵選擇**重新命名**
        3. 透過**勾選或拖曳方式**將欄位放入四大欄位區塊
        4.  **任務A (基礎)：** 建立樞紐分析表，分析「各區域」在「各產品類別」的「總銷售額」。
        5.  **任務B (進階)：**
            *   新增「毛利」的**計算欄位** (`= 銷售額 - 成本`)。
            *   新增「區域」和「產品類別」的**交叉分析篩選器**。
            *   將「日期」欄位**群組**為「月份」，觀察每月趨勢。
            *   將「銷售額」複製一份，並將其**值的顯示方式**改為「佔總和百分比」。
            
1. 什麼是「逆樞紐分析行」？

    簡單來說，它是一個「將寬表格變成長表格」的魔法按鈕。
    
    * 寬表格 (Wide Table)：人類喜歡看的格式。通常特徵或數值被當作欄位標題，例如每個月的銷售額分別佔據一欄。
    * 長表格 (Long Table)：電腦和分析工具喜歡的格式。也稱為「Tidy Data」，所有數值都在同一個欄位中，而它們的特徵則在另一個欄位。
    
    「逆樞紐分析行」的作用，就是把那些作為「欄位標題」的特徵（例如 "一月", "二月"）融化 (Melt) 或 堆疊 (Stack) 下來，變成一欄新的資料。

---

2. 一個簡單的視覺化範例

    文字可能有點抽象，讓我們看一個「之前 vs. 之後」的例子，您馬上就能明白。
    
    處理前：寬表格 (不適合分析的格式)
    
    假設您的原始報表長這樣，第一欄是產品，後面幾欄分別是不同月份的銷售額。
    
    
    
    | 產品 | 一月 | 二月 | 三月 |
    |---|---|---|---|
    | 蘋果 | 100  | 120  | 150  |
    | 香蕉 | 80   | 90   | 110  |
    
    
    
    問題點：一月、二月、三月
    這些本質上是「時間」的值，卻被當成了欄位。這種格式讓您很難用樞紐分析表去分析「哪種水果的總銷量最高」或「全年的銷售趨勢」。
    
    處理後：長表格 (適合分析的格式)
    
    經過「逆樞紐分析行」處理後，表格會變成這樣：
    
    
    
    | 產品 | 月份 | 銷售額 |
    |---|---|---|
    | 蘋果 | 一月 | 100    |
    | 蘋果 | 二月 | 120    |
    | 蘋果 | 三月 | 150    |
    | 香蕉 | 一月 | 80     |
    | 香蕉 | 二月 | 90     |
    | 香蕉 | 三月 | 110    |
    
    
    發生了什麼事？
    
    1. 原本的 一月、二月、三月 這三個欄位被「融化」並合併成一個新的欄位，我們將其命名為「月份」。
    2. 原本在這三個欄位下的所有數值，則被集中到另一個新的欄位，我們將其命名為「銷售額」。
    3. 產品 欄位作為固定的識別欄，其內容會被自動向下填充，以匹配新的資料結構。

---

3. 如何操作？(操作步驟)

    在 Power Query 編輯器中，操作非常簡單：
    
    1. 載入資料：首先，將您的寬表格載入到 Power Query 編輯器中。
    
    2. 選取欄位：這是最關鍵的一步。您有兩種策略：
       * 策略A (推薦)：選取不需要被逆樞紐的欄位。在我們的例子中，就是選取「產品」這一欄。
       * 策略B：選取所有需要被逆樞紐的欄位。在我們的例子中，就是同時選取「一月」、「二月」和「三月」這三欄。
    
    3. 執行逆樞紐：
       * 前往頂端選單的「轉換 (Transform)」索引標籤。
       * 點擊「逆樞紐分析行 (Unpivot Columns)」按鈕的下拉箭頭。
       * 如果您採用策略A，請選擇「取消其他資料行的樞紐 (Unpivot Other
         Columns)」。(這是最常用的選項，因為未來如果增加了「四月」的欄位，這個查詢步驟依然有效)。
       * 如果您採用策略B，請選擇「取消資料行的樞紐 (Unpivot Columns)」。

    4. 重新命名：
       Power Query 會自動產生兩個新欄位，預設名稱為 屬性 (Attribute) 和 值 (Value)。請對這兩個新欄位的標題按兩下，將它們重新命名為有意義的名稱，例如「月份」和「銷售額」。
    
    5. 關閉並載入：
       點擊左上角的「關閉並載入」，將整理好的長表格載入到新的 Excel 工作表中。

---

4. 為什麼這個功能如此重要？

* 為了樞紐分析：只有「長表格」格式的資料，才能在樞紐分析表中發揮最大作用，讓您可以隨意拖拉「月份」或「產品」到欄、列或篩選區域。
* 為了自動化：這個轉換步驟會被 Power Query 記錄下來。下個月，當您的原始報表增加了「四月」的欄位時，您不需要重複任何操作，只需在查詢結果上按右鍵「重新整理」，四月的資料就會自動被逆樞紐並追加到長表格的末端。
* 為了標準化：它是將各種不規範、人類可讀的報表，轉換為標準化、機器可讀的「資料庫格式」的核心工具。

---

### 統計圖表的設計與應用

*   **內容解說：**
    *   **圖表是數據的語言：** 強調圖表的目的在於「講故事」，快速傳達數據背後的洞見。
    *   **從樞紐分析到樞紐分析圖：** 學習如何一鍵將樞紐分析表轉換為連動的樞紐分析圖，讓數據分析結果視覺化。
    *   **選擇正確的圖表類型：**
        *   **長條圖/柱狀圖：** 用於比較不同類別的數值大小。
        *   **折線圖：** 用於呈現隨時間變化的趨勢。
        *   **圓餅圖：** 用於顯示各部分佔整體的比例（提醒：類別過多時不適用）。
        *   **組合圖：** 將不同度量單位（如銷售額與成長率）呈現在同一張圖上，進行多維度比較。
    *   **圖表設計原則：** 介紹如何美化圖表，包括移除不必要的格線、加上清晰的標題與資料標籤，讓圖表簡潔有力。

*   **操作範例：**
    *   **範例資料：** 延續單元一的樞紐分析表結果。
    *   **操作任務：**
        1.  **任務A：** 基於分析「各區域每月銷售額」的樞紐分析表，建立一張**折線圖**，呈現各區域的銷售趨勢。
        2.  **任務B：** 建立一張**組合圖**，同時呈現各產品類別的「總銷售額」（柱狀圖）與「毛利率」（折線圖，使用副座標軸）。

---

### 資料透視與結構化分析

*   **內容解說：**
    *   **Garbage In, Garbage Out：** 強調數據品質的重要性。結構混亂的資料無法進行有效分析。
    *   **何謂「結構化資料 (Tidy Data)」：** 介紹標準的清單式資料結構（一列一筆記錄，一欄一個變數），這是樞紐分析與多數分析工具的基礎要求。
    *   **常見的非結構化資料：** 展示常見的錯誤格式，如合併儲存格、多層標題、以及將月份當作欄位的「交叉表」。
    *   **Power Query 逆樞紐 (Unpivot)：** 介紹 Excel 內建的強大 ETL (萃取、轉換、載入) 工具 Power Query，並聚焦於其核心功能「逆樞紐分析行」，能快速將交叉表轉換為結構化清單。

*   **操作範例：**
    *   **範例資料：** 一份產品銷售報告，第一欄是「產品名稱」，後續欄位分別是「一月銷售額」、「二月銷售額」、「三月銷售額」...
    *   **操作任務：**
        1.  使用 **Power Query** 載入此交叉表。
        2.  選取「產品名稱」欄，使用「**取消其他資料行的樞紐**」功能。
        3.  將新產生的「屬性」欄位重新命名為「月份」，「值」欄位命名為「銷售額」。
        4.  將整理好的結構化資料載入新的工作表，使其可用於樞紐分析。

---

### 自動化數據處理範例

*   **內容解說：**
    *   **告別重複的手動操作：** 解釋 Power Query 的所有操作步驟都會被記錄下來，形成一個可重複執行的查詢。當來源資料更新或增加時，只需一鍵「重新整理」，所有整理步驟都會自動重跑。
    *   **合併多份檔案：** 介紹 Power Query 最令人驚豔的功能之一：從資料夾合併多個結構相同的檔案（Excel 或 CSV）。這對於需要匯總每月、每週或各分店報表的工作極為高效。
    *   **數據格式轉換：** 在 Power Query 編輯器中，可以輕鬆完成資料類型轉換（如將文字格式的日期轉為日期格式）、分割欄位、取代文字等常見的數據清理工作。

*   **操作範例：**
    *   **範例資料：** 一個資料夾，內含三份結構完全相同的銷售報表：`1月銷售.csv`, `2月銷售.csv`, `3月銷售.csv`。
    *   **操作任務：**
        1.  開啟 Power Query，選擇「**從檔案**」>「**從資料夾**」。
        2.  選取包含三份報表的資料夾，點擊「**合併與轉換資料**」。
        3.  Power Query 會自動將所有檔案的內容合併成一個大的資料表。
        4.  **驗證：** 將一份新的 `4月銷售.csv` 檔案放入同一個資料夾，然後在 Excel 中對查詢按下滑鼠右鍵選擇「**重新整理**」，觀察到4月的數據被自動合併進來。
